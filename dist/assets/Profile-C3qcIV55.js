import{v as E,o as A,n as O,j as e,k as p,r as v,i as b,G as h,S,q as C,p as y,E as V,u as I,U as M}from"./index-JcghwglV.js";const R=({checked:t,onChange:s,labelId:i})=>{const o=()=>{s(!t)};return e.jsx("button",{type:"button",role:"switch","aria-checked":t,"aria-labelledby":i,onClick:o,className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${t?"bg-indigo-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200 ease-in-out ${t?"translate-x-6":"translate-x-1"}`})})},L=()=>{const{user:t}=E(),{updateUserNotificationPreferences:s}=A(),i=(t==null?void 0:t.notificationPreferences)||O,o=(n,m)=>{t&&(s({[n]:m}),p("偏好已更新"))};if(!t)return e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"无法加载通知偏好设置。"});const a=[{id:"receiveActivityJoinNotifications",label:"有人报名我的活动"},{id:"receiveNewCommentNotifications",label:"我的活动有新留言"},{id:"receiveActivityUpdateNotifications",label:"我参与的活动有更新"},{id:"receiveSystemAnnouncements",label:"系统公告和重要通知"}];return e.jsx("div",{className:"notification-preferences-section",children:e.jsx("div",{className:"space-y-3",children:a.map((n,m)=>e.jsxs("div",{className:`flex items-center justify-between p-3 bg-white rounded-md shadow-sm ${m>0?"mt-2":""}`,children:[e.jsx("label",{htmlFor:`switch-${n.id}`,className:"text-sm text-gray-700 flex-grow mr-4 cursor-pointer",onClick:()=>o(n.id,!i[n.id]),children:n.label}),e.jsx(R,{checked:i[n.id],onChange:d=>o(n.id,d),labelId:`switch-label-${n.id}`}),e.jsx("span",{id:`switch-label-${n.id}`,className:"sr-only",children:n.label})]},n.id))})})},j=({label:t,name:s,type:i="text",error:o,...a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:t}),e.jsx("input",{id:s,name:s,type:i,...a,className:`block w-full px-3 py-2 border ${o?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}),o&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:o})]}),_=({label:t,name:s,error:i,showCount:o,maxLength:a,value:n,...m})=>{var d;return e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:t}),e.jsx("textarea",{id:s,name:s,...m,value:n,maxLength:a,className:`block w-full px-3 py-2 border ${i?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm`}),i&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:i}),o&&a&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500 text-right",children:[((d=String(n))==null?void 0:d.length)||0," / ",a]})]})},q=({visible:t,onClose:s})=>{const{user:i}=E(),{updateUserProfile:o}=A(),[a,n]=v.useState({nickname:"",city:"",climbingAge:0,introduction:"",climbingPreferences:[],frequentlyVisitedGyms:"",gearTags:[]}),[m,d]=v.useState({}),w=[{label:"抱石",value:b.BOULDERING},{label:"运动攀岩",value:b.LEAD_CLIMBING},{label:"传统攀岩",value:b.TOP_ROPE_MANUAL_BELAY},{label:"室内",value:b.TOP_ROPE_AUTO_BELAY},{label:"室外",value:b.OUTDOOR}],k=[{label:"快挂",value:h.QUICKDRAWS},{label:"绳索",value:h.ROPE},{label:"安全带",value:h.HARNESS},{label:"下降器",value:h.BELAY_DEVICE},{label:"攀岩鞋",value:h.SHOES},{label:"头盔",value:h.HELMET}];v.useEffect(()=>{i&&t&&(n({nickname:i.nickname||"",city:i.city||"",climbingAge:i.climbingAge!==void 0?i.climbingAge:0,introduction:i.introduction||"",climbingPreferences:i.climbingPreferences||[],frequentlyVisitedGyms:Array.isArray(i.frequentlyVisitedGyms)?i.frequentlyVisitedGyms.join(", "):i.frequentlyVisitedGyms||"",gearTags:i.gearTags||[]}),d({}))},[i,t]);const g=l=>{const{name:r,value:c}=l.target;n(x=>({...x,[r]:c})),m[r]&&d(x=>({...x,[r]:void 0}))},T=(l,r)=>{const c=Number(r);n(x=>({...x,[l]:Math.max(0,c)})),m[l]&&d(x=>({...x,[l]:void 0}))},P=()=>{var c;const l={},r=(c=a.nickname)==null?void 0:c.trim();return r?r.length<y.NICKNAME.MIN_LENGTH?l.nickname=`昵称至少${y.NICKNAME.MIN_LENGTH}个字符`:r.length>y.NICKNAME.MAX_LENGTH&&(l.nickname=`昵称最多${y.NICKNAME.MAX_LENGTH}个字符`):l.nickname="昵称不能为空",d(l),Object.keys(l).length===0},G=async l=>{if(l.preventDefault(),!i||!P())return;const r={...a,climbingAge:Number(a.climbingAge),frequentlyVisitedGyms:a.frequentlyVisitedGyms?a.frequentlyVisitedGyms.split(",").map(c=>c.trim()).filter(c=>c):[]};try{o(r),p(S.PROFILE_UPDATED),s()}catch(c){C(V.SERVER_ERROR),console.error("Failed to update profile:",c)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"编辑个人信息"}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("form",{onSubmit:G,children:[e.jsx(j,{label:"昵称",name:"nickname",value:a.nickname,onChange:g,placeholder:"请输入昵称",error:m.nickname,required:!0}),e.jsx(j,{label:"城市",name:"city",value:a.city,onChange:g,placeholder:"请输入城市"}),e.jsx(j,{label:"岩龄 (年)",name:"climbingAge",type:"number",value:a.climbingAge===void 0?"":String(a.climbingAge),onChange:l=>T("climbingAge",l.target.value),min:"0"}),e.jsx(_,{label:"简介",name:"introduction",value:a.introduction,onChange:g,placeholder:"介绍一下自己吧",rows:3,maxLength:100,showCount:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"攀爬偏好"}),e.jsx("div",{className:"space-y-2",children:w.map(l=>{var r;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((r=a.climbingPreferences)==null?void 0:r.includes(l.value))||!1,onChange:c=>{const x=c.target.checked?[...a.climbingPreferences||[],l.value]:(a.climbingPreferences||[]).filter(u=>u!==l.value);n(u=>({...u,climbingPreferences:x}))},className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:l.label})]},l.value)})})]}),e.jsx(j,{label:"常去的岩馆 (用逗号分隔)",name:"frequentlyVisitedGyms",value:a.frequentlyVisitedGyms,onChange:g,placeholder:"例如：岩馆A, 岩馆B"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"我的装备"}),e.jsx("div",{className:"space-y-2",children:k.map(l=>{var r;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((r=a.gearTags)==null?void 0:r.includes(l.value))||!1,onChange:c=>{const x=c.target.checked?[...a.gearTags||[],l.value]:(a.gearTags||[]).filter(u=>u!==l.value);n(u=>({...u,gearTags:x}))},className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:l.label})]},l.value)})})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out",children:"保存"})]})]})}):null},f=({name:t,className:s="w-5 h-5"})=>e.jsxs("span",{className:`inline-block text-gray-500 ${s}`,children:["[",t,"]"]}),U=t=>e.jsx(f,{...t,name:"Set"}),D=t=>e.jsx(f,{...t,name:"Team"}),F=t=>e.jsx(f,{...t,name:"Star"}),$=t=>e.jsx(f,{...t,name:"Flag"}),B=t=>e.jsx(f,{...t,name:"Mail"}),N=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})}),z=()=>{const t=I(),{user:s}=E(),{logout:i}=A(),[o,a]=v.useState(!1),n=async()=>{if(window.confirm("确定要退出登录吗？"))try{await i(),t("/login"),p(S.LOGOUT_SUCCESS)}catch{C("退出登录失败，请重试")}},m=()=>{a(!0)},d=g=>{t(`/my-activities?type=${g}`)},w=()=>{t("/my-reviews")},k=()=>{window.location.href="mailto:feedback@climberdaz.example.com?subject=ClimberDaz App Feedback",p("打开邮件客户端以发送反馈...")};return s?e.jsxs("div",{className:"profile-page bg-gray-100 min-h-screen pb-16",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-20",children:e.jsx("div",{className:"max-w-md mx-auto px-4",children:e.jsxs("div",{className:"relative flex items-center justify-center h-12",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"个人中心"}),e.jsx("button",{onClick:m,className:"absolute right-0 p-2 text-blue-500 hover:text-blue-700","aria-label":"Edit profile",children:e.jsx(U,{className:"w-6 h-6"})})]})})}),e.jsxs("div",{className:"profile-content p-4 space-y-4",children:[e.jsxs("div",{className:"user-info-card bg-white shadow-lg rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(M,{avatar:s.avatar,nickname:s.nickname,level:s.level,size:80}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:s.nickname}),s.level&&e.jsxs("div",{className:"text-sm text-yellow-500",children:["Lv.",s.level," 攀岩达人"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["ID: ",s.openid.slice(-8)]}),s.city&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["城市: ",s.city]}),s.climbingAge!==void 0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["岩龄: ",s.climbingAge,"年"]})]})]}),s.introduction&&e.jsxs("p",{className:"text-sm text-gray-600 mt-3 pt-3 border-t border-gray-200",children:["简介: ",s.introduction]})]}),e.jsxs("div",{className:"menu-card bg-white shadow-lg rounded-lg overflow-hidden",children:[e.jsxs("div",{onClick:()=>d("hosted"),className:"flex items-center p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50",children:[e.jsx($,{className:"mr-3 text-blue-500"}),e.jsx("span",{className:"flex-1 text-gray-700",children:"我发起的活动"}),e.jsx(N,{})]}),e.jsxs("div",{onClick:()=>d("joined"),className:"flex items-center p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50",children:[e.jsx(D,{className:"mr-3 text-green-500"}),e.jsx("span",{className:"flex-1 text-gray-700",children:"我参与的活动"}),e.jsx(N,{})]}),e.jsxs("div",{onClick:w,className:"flex items-center p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50",children:[e.jsx(F,{className:"mr-3 text-yellow-500"}),e.jsx("span",{className:"flex-1 text-gray-700",children:"我的评价"}),e.jsx(N,{})]}),e.jsxs("div",{onClick:k,className:"flex items-center p-4 cursor-pointer hover:bg-gray-50",children:[e.jsx(B,{className:"mr-3 text-purple-500"}),e.jsx("span",{className:"flex-1 text-gray-700",children:"发送反馈"}),e.jsx(N,{})]})]}),e.jsxs("div",{className:"notification-settings-card bg-white shadow-lg rounded-lg",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700 p-4 border-b border-gray-200",children:"通知设置"}),e.jsx("div",{className:"p-4",children:e.jsx(L,{})})]}),s.climbingPreferences&&s.climbingPreferences.length>0||s.frequentlyVisitedGyms&&s.frequentlyVisitedGyms.length>0||s.gearTags&&s.gearTags.length>0?e.jsxs("div",{className:"climbing-info-card bg-white shadow-lg rounded-lg",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700 p-4 border-b border-gray-200",children:"攀爬信息"}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[s.climbingPreferences&&s.climbingPreferences.length>0&&e.jsxs("div",{className:"p-4 flex",children:[e.jsx("span",{className:"w-24 text-sm text-gray-500 font-medium",children:"偏好类型"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.climbingPreferences.join(", ")})]}),s.frequentlyVisitedGyms&&s.frequentlyVisitedGyms.length>0&&e.jsxs("div",{className:"p-4 flex",children:[e.jsx("span",{className:"w-24 text-sm text-gray-500 font-medium",children:"常去岩馆"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.frequentlyVisitedGyms.join(", ")})]}),s.gearTags&&s.gearTags.length>0&&e.jsxs("div",{className:"p-4 flex",children:[e.jsx("span",{className:"w-24 text-sm text-gray-500 font-medium",children:"我的装备"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.gearTags.join(", ")})]})]})]}):null,e.jsx("div",{className:"action-section mt-6 mb-2",children:e.jsx("button",{className:"w-full py-3 px-4 rounded-lg font-semibold bg-red-500 hover:bg-red-600 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-150 ease-in-out",onClick:n,children:"退出登录"})})]}),s&&e.jsx(q,{visible:o,onClose:()=>a(!1)})]}):e.jsx("div",{className:"p-4 text-center",children:"请先登录"})};export{z as default};
