import{t as q,u as V,a as K,e as Q,v as X,r as h,j as e,w as N,M as Y,C as U,U as B,k as z,q as J}from"./index-JcghwglV.js";const b=({name:i,className:n="w-5 h-5 inline-block"})=>e.jsxs("span",{className:`text-gray-500 ${n}`,children:["[",i,"]"]}),Z=i=>e.jsx(b,{...i,name:"Time"}),ee=i=>e.jsx(b,{...i,name:"LocPin"}),se=i=>e.jsx(b,{...i,name:"User"}),te=i=>e.jsx(b,{...i,name:"Chat"}),_=[{activityId:"1",userId:"user2",joinTime:new Date,user:{openid:"user2",nickname:"Alice",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Alice",level:3,gearTags:[],createdAt:new Date}},{activityId:"1",userId:"user3",joinTime:new Date,user:{openid:"user3",nickname:"Bob",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",level:2,gearTags:[],createdAt:new Date}}],ae=[{id:"1",activityId:"1",userId:"user2",content:"期待！我会准时到的",timestamp:new Date,user:{openid:"user2",nickname:"Alice",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Alice",level:3,gearTags:[],createdAt:new Date}}],v=({color:i,children:n,className:o,antdColor:l})=>{let a="bg-gray-200",s="text-gray-700";return i==="warning"||l==="warning"?(a="bg-yellow-400",s="text-yellow-800"):i==="primary"||l==="primary"?(a="bg-blue-500",s="text-white"):(i==="success"||l==="success")&&(a="bg-green-500",s="text-white"),e.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-md ${a} ${s} ${o||""}`,children:n})},F=({description:i,imageStyle:n,className:o})=>e.jsxs("div",{className:`flex flex-col items-center justify-center text-center p-8 text-gray-500 ${o||""}`,children:[e.jsx("div",{className:"text-4xl mb-4",style:n,children:"📭"})," ",e.jsx("p",{children:i})]}),ne=()=>{var M,T,E,L,D,P,S;const{id:i}=q(),n=V(),{activities:o}=K(),{setCurrentActivity:l}=Q(),{user:a}=X(),[s,k]=h.useState(void 0),[r,g]=h.useState([]),[d,C]=h.useState([]),[y,u]=h.useState(!1),[m,p]=h.useState(!1);h.useEffect(()=>{var c;const t=o.find(x=>x.id===i);t?(k(t),l(t),t.id==="1"?(g(_),C(ae),u(_.some(x=>x.userId===(a==null?void 0:a.openid)))):(g([]),C([]),u(((c=t.participantIds)==null?void 0:c.includes((a==null?void 0:a.openid)||""))||!1))):(k(void 0),l(null))},[i,o,l,a]);const A=()=>{n(-1)},H=async()=>{if(!(!a||!s)){p(!0);try{await new Promise(c=>setTimeout(c,1e3));const t={activityId:s.id,userId:a.openid,joinTime:new Date,user:a};g([...r,t]),u(!0),z("报名成功！")}catch{J("报名失败，请重试")}finally{p(!1)}}},O=async()=>{if(!(!a||!s)&&window.confirm("确定要取消报名吗？")){p(!0);try{await new Promise(t=>setTimeout(t,1e3)),g(r.filter(t=>t.userId!==a.openid)),u(!1),z("已取消报名")}catch{J("取消失败，请重试")}finally{p(!1)}}},I=t=>{n(`/profile/${t}`)},R=()=>{n(`/activity/${i}/comments`)};if(!s)return e.jsxs("div",{className:"activity-detail-page bg-gray-100 min-h-screen",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-md mx-auto px-4",children:e.jsxs("div",{className:"relative flex items-center justify-center h-12",children:[e.jsx("button",{onClick:A,className:"absolute left-0 p-2 text-blue-500 hover:text-blue-700","aria-label":"Go back",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"活动详情"})]})})}),e.jsx(F,{description:"活动不存在"})]});const j=(a==null?void 0:a.openid)===s.hostId,f=r.length>=s.slotMax,w=N(s.datetime).isBefore(N()),G=!j&&!y&&!f&&!w,W=y&&!j&&!w;return e.jsxs("div",{className:"activity-detail-page bg-gray-100 min-h-screen pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-md mx-auto px-4",children:e.jsxs("div",{className:"relative flex items-center justify-center h-12",children:[e.jsx("button",{onClick:A,className:"absolute left-0 p-2 text-blue-500 hover:text-blue-700","aria-label":"Go back",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"活动详情"})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-3",children:s.title}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"mr-2 text-gray-500"}),e.jsx("span",{children:N(s.datetime).format("MM月DD日 HH:mm")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2 text-gray-500"}),e.jsx("span",{children:s.locationText})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"mr-2 text-gray-500"}),e.jsxs("span",{children:[r.length,"/",s.slotMax,"人",f&&e.jsx(v,{antdColor:"warning",className:"ml-2",children:"已满员"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(v,{antdColor:"primary",children:s.meetMode===Y.MEET_AT_ENTRANCE?"门口集合":"先到先攀"}),e.jsx(v,{antdColor:"success",children:s.costMode===U.FREE?"免费":s.costMode===U.AA?"AA":"我请客"}),s.isPrivate&&e.jsx(v,{antdColor:"warning",children:"私密活动"})]})]}),e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-md font-semibold text-gray-700",children:"发起人"})}),e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:()=>I(s.hostId),children:[e.jsx(B,{avatar:(M=s.host)==null?void 0:M.avatar,nickname:((T=s.host)==null?void 0:T.nickname)||"发起人",level:(E=s.host)==null?void 0:E.level,size:48}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:((L=s.host)==null?void 0:L.nickname)||"发起人"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Lv.",((D=s.host)==null?void 0:D.level)||1]})]})]})]}),e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-md font-semibold text-gray-700",children:["参与者 (",r.length,")"]})}),r.length>0?e.jsx("div",{className:"flex flex-wrap gap-3",children:r.map(t=>{var c,x,$;return e.jsxs("div",{className:"flex flex-col items-center cursor-pointer transform hover:scale-105 transition-transform duration-150",onClick:()=>I(t.userId),children:[e.jsx(B,{avatar:((c=t.user)==null?void 0:c.avatar)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.userId}`,nickname:((x=t.user)==null?void 0:x.nickname)||t.userId,size:40}),e.jsx("span",{className:"text-xs mt-1 text-gray-600 truncate w-16 text-center",children:(($=t.user)==null?void 0:$.nickname)||t.userId})]},t.userId)})}):e.jsx(F,{description:"暂无其他参与者",className:"py-4",imageStyle:{width:60}})]}),e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4 cursor-pointer hover:bg-gray-50",onClick:R,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-md font-semibold text-gray-700",children:["留言板 (",d.length,")"]}),e.jsx(te,{className:"text-gray-400"})]}),d.length>0&&s&&s.comments&&s.comments.length>0?e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("strong",{className:"text-gray-800",children:[((P=s.comments[0].user)==null?void 0:P.nickname)||"User",":"]})," ",s.comments[0].content,s.comments.length>1&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"...和更多"})]}):d.length>0?e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("strong",{className:"text-gray-800",children:[((S=d[0].user)==null?void 0:S.nickname)||"User",":"]})," ",d[0].content,d.length>1&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"...和更多"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"暂无留言，点击查看或添加。"})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white p-3 shadow-top z-10 max-w-md mx-auto border-t border-gray-200",children:j?e.jsx("button",{className:"w-full py-3 px-4 rounded-lg bg-gray-300 text-gray-600 font-semibold cursor-not-allowed",disabled:!0,children:"你是发起人"}):w?e.jsx("button",{className:"w-full py-3 px-4 rounded-lg bg-gray-300 text-gray-600 font-semibold cursor-not-allowed",disabled:!0,children:"活动已开始"}):G?e.jsx("button",{className:`w-full py-3 px-4 rounded-lg font-semibold text-white ${m?"bg-blue-300":"bg-blue-500 hover:bg-blue-600"}`,disabled:m,onClick:H,children:m?"处理中...":"立即报名"}):W?e.jsx("button",{className:`w-full py-3 px-4 rounded-lg font-semibold ${m?"bg-gray-200 text-gray-500":"bg-red-500 hover:bg-red-600 text-white"}`,disabled:m,onClick:O,children:m?"处理中...":"取消报名"}):f?e.jsx("button",{className:"w-full py-3 px-4 rounded-lg bg-gray-300 text-gray-600 font-semibold cursor-not-allowed",disabled:!0,children:"已满员"}):y&&!j?e.jsx("button",{className:"w-full py-3 px-4 rounded-lg bg-green-500 text-white font-semibold cursor-not-allowed",disabled:!0,children:"已报名"}):e.jsx("button",{className:"w-full py-3 px-4 rounded-lg bg-gray-300 text-gray-600 font-semibold cursor-not-allowed",disabled:!0,children:"暂不可操作"})})]})};export{ne as default};
