import{r,j as e,x as S,t as L,u as E,y as z,w as b,U as T}from"./index-JcghwglV.js";import{r as $}from"./zh-cn-LA4RAP2U.js";import{u as A}from"./useStore-BVSIr33F.js";function B({title:t,titleId:s,...n},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":s},n),t?r.createElement("title",{id:s},t):null,r.createElement("path",{fillRule:"evenodd",d:"M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z",clipRule:"evenodd"}))}const R=r.forwardRef(B),P=({title:t,onBack:s})=>e.jsxs("div",{className:"bg-white shadow-md h-12 flex items-center justify-between px-4 sticky top-0 z-50",children:[s&&e.jsx("button",{onClick:s,className:"p-2 -ml-2",children:e.jsx(R,{className:"h-6 w-6 text-gray-600"})}),e.jsx("h1",{className:`text-lg font-semibold text-gray-800 ${s?"mx-auto":"ml-0"}`,children:t}),s&&e.jsx("div",{className:"w-6"})]}),F=({children:t})=>e.jsx("div",{className:"divide-y divide-gray-200",children:t}),D=({prefix:t,description:s,children:n})=>e.jsx("div",{className:"p-4 bg-white",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[t&&e.jsx("div",{className:"flex-shrink-0",children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[n,s&&e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:s})]})]})}),H=({placeholder:t,value:s,onChange:n,rows:i=2,maxLength:o,disabled:m})=>e.jsx("textarea",{placeholder:t,value:s,onChange:c=>n(c.target.value),rows:i,maxLength:o,disabled:m,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 resize-none disabled:bg-gray-100"}),M=({children:t,onClick:s,variant:n="primary",size:i="md",loading:o=!1,disabled:m=!1,type:c="button",className:h="",startIcon:p,endIcon:x,fullWidth:u=!1})=>{const f=["inline-flex","items-center","justify-center","font-medium","rounded-lg","transition-all","duration-200","ease-smooth","focus:outline-none","focus:ring-2","focus:ring-offset-2","transform","active:scale-95","disabled:transform-none","disabled:cursor-not-allowed","disabled:opacity-50","relative","overflow-hidden"].join(" "),l={sm:"px-3 py-2 text-sm min-h-[36px] gap-1.5",md:"px-4 py-2.5 text-sm min-h-[40px] gap-2",lg:"px-6 py-3 text-base min-h-[44px] gap-2.5"},v={primary:["bg-gradient-to-r from-primary-500 to-primary-600","text-white","shadow-soft","hover:from-primary-600 hover:to-primary-700","hover:shadow-medium","focus:ring-primary-500","active:from-primary-700 active:to-primary-800"].join(" "),secondary:["bg-gradient-to-r from-secondary-500 to-secondary-600","text-white","shadow-soft","hover:from-secondary-600 hover:to-secondary-700","hover:shadow-medium","focus:ring-secondary-500","active:from-secondary-700 active:to-secondary-800"].join(" "),outline:["bg-transparent","text-primary-600","border-2 border-primary-500","hover:bg-primary-50","hover:text-primary-700","hover:border-primary-600","focus:ring-primary-500","active:bg-primary-100"].join(" "),ghost:["bg-transparent","text-neutral-700","hover:bg-neutral-100","hover:text-neutral-800","focus:ring-neutral-500","active:bg-neutral-200"].join(" ")},g=u?"w-full":"",y=()=>e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),w=e.jsxs(e.Fragment,{children:[p&&!o&&e.jsx("span",{className:"flex-shrink-0",children:p}),e.jsx("span",{className:o?"opacity-0":"opacity-100",children:t}),x&&!o&&e.jsx("span",{className:"flex-shrink-0",children:x}),o&&e.jsx(y,{})]});return e.jsx("button",{type:c,onClick:s,disabled:m||o,className:`
        ${f}
        ${l[i]}
        ${v[n]}
        ${g}
        ${h}
      `,style:{transitionProperty:"all",transitionTimingFunction:S.easings.smooth,transitionDuration:S.normal},children:w})};function U({title:t,titleId:s,...n},i){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":s},n),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z"}))}const V=r.forwardRef(U),_=({description:t,icon:s=V})=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-8",children:[e.jsx(s,{className:"h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500 text-sm",children:t})]});b.extend($);b.locale("zh-cn");const O=[{id:"1",activityId:"1",userId:"user2",content:"期待！我会准时到的，大家记得带好装备哦～",timestamp:new Date(Date.now()-36e5),user:{openid:"user2",nickname:"Alice",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Alice",level:3,gearTags:[],createdAt:new Date}},{id:"2",activityId:"1",userId:"user3",content:"请问新手可以参加吗？我只爬过V2的线路",timestamp:new Date(Date.now()-72e5),user:{openid:"user3",nickname:"Bob",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",level:1,gearTags:[],createdAt:new Date}},{id:"3",activityId:"1",userId:"user1",content:"当然可以！我们会互相帮助的，新手也欢迎",timestamp:new Date(Date.now()-6e6),user:{openid:"user1",nickname:"发起人",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Host",level:5,gearTags:[],createdAt:new Date}}],j=()=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]}),G=()=>{const{id:t}=L(),s=E(),{user:n,currentActivity:i}=A(),[o,m]=r.useState([]),[c,h]=r.useState(""),[p,x]=r.useState(!1),[u,f]=r.useState(!1),l=z(),v=r.useCallback(async()=>{x(!0);try{await new Promise(d=>setTimeout(d,500));const a=O.filter(d=>d.activityId===t);m(a)}catch{l.show({content:"加载评论失败",position:"center",icon:"fail"})}finally{x(!1)}},[t,l]);r.useEffect(()=>{v()},[t,v]);const g=()=>{s(-1)},y=async()=>{if(!c.trim()){l.show({content:"请输入评论内容",position:"center",icon:"fail"});return}if(!n){l.show({content:"请先登录",position:"center",icon:"fail"}),s("/login");return}if(c.length>100){l.show({content:"评论不能超过100字",position:"center",icon:"fail"});return}f(!0);try{await new Promise(d=>setTimeout(d,1e3));const a={id:`comment_${Date.now()}`,activityId:t,userId:n.openid,content:c.trim(),timestamp:new Date,user:n};m([a,...o]),h(""),l.show({content:"发送成功",position:"center",icon:"success"})}catch{l.show({content:"发送失败，请重试",position:"center",icon:"fail"})}finally{f(!1)}},w=a=>{s(`/profile/${a}`)},I=a=>a===(i==null?void 0:i.hostId);return e.jsxs("div",{className:"bg-gray-50 min-h-screen flex flex-col",children:[e.jsx(P,{onBack:g,title:"留言板"}),e.jsx("div",{className:"flex-1 overflow-y-auto pb-20",children:p?e.jsx("div",{className:"pt-4",children:[1,2,3].map(a=>e.jsx(D,{prefix:e.jsx(j,{}),description:e.jsx(j,{}),children:e.jsx(j,{})},a))}):o.length===0?e.jsx("div",{className:"pt-10",children:e.jsx(_,{description:"暂无留言，快来抢沙发！"})}):e.jsx(F,{children:o.map(a=>{var d,N,k,C;return e.jsxs(D,{prefix:e.jsx("div",{onClick:()=>w(a.userId),className:"cursor-pointer",children:e.jsx(T,{avatar:(d=a.user)==null?void 0:d.avatar,nickname:((N=a.user)==null?void 0:N.nickname)||"用户",level:(k=a.user)==null?void 0:k.level,size:40})}),description:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs",children:b(a.timestamp).fromNow()}),I(a.userId)&&e.jsx("span",{className:"ml-auto px-1.5 py-0.5 text-xs bg-sky-100 text-sky-700 rounded-full font-medium",children:"发起人"})]}),children:[e.jsx("div",{className:"flex items-center mb-0.5",children:e.jsx("span",{className:"font-medium text-gray-900 text-[15px] truncate",children:((C=a.user)==null?void 0:C.nickname)||"用户"})}),e.jsx("div",{className:"text-sm text-gray-700 leading-normal break-words whitespace-pre-wrap",children:a.content})]},a.id)})})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 pt-3 pb-[calc(0.75rem+env(safe-area-inset-bottom))] flex items-end gap-3 z-40",children:[e.jsx("div",{className:"flex-1",children:e.jsx(H,{placeholder:"说点什么...",value:c,onChange:h,rows:2,maxLength:100,disabled:u})}),e.jsx(M,{variant:"primary",size:"md",loading:u,onClick:y,disabled:!c.trim()||u,children:"发送"})]})]})};export{G as default};
