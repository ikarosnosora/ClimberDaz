import{j as e,U as t,T as s,B as r}from"./auth-features-B9i09fKj.js";import{b as a,u as i,r as l}from"./router-DIp0qzM7.js";import{u as n}from"./activity-features-BeCPKsHJ.js";import{B as o}from"./notifications-DK5Y3Ipx.js";import"./utils-C8L9ZeeV.js";import"./storage-BRXjPTYW.js";import"./react-core-DJd1KkWy.js";import"./state-Dl9MXZu6.js";import"./datetime-C5xEksKA.js";import"./http-client-CnGGTTUv.js";const d=()=>{const{activityId:d,targetId:c}=a(),m=i(),{user:x}=n(),[g,h]=l.useState(null),[b,j]=l.useState({rating:"SKIP",comment:""}),[u]=l.useState(!1),[v,p]=l.useState(null);return l.useEffect((()=>{d&&c&&h({id:c,name:"æ”€å²©ä¼™ä¼´",avatar:"/images/default-avatar.jpg",activityTitle:"å‘¨æœ«æ¬¢ä¹æŠ±çŸ³å±€",activityDate:new Date})}),[d,c]),g?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-blue-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>m(-1),className:"flex items-center text-gray-600 hover:text-gray-800 mb-4",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"è¿”å›"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"è¯„ä»·æ´»åŠ¨ä¼™ä¼´"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(t,{avatar:g.avatar,nickname:g.name,size:"lg"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:g.name}),e.jsx("p",{className:"text-gray-600",children:g.activityTitle}),e.jsx("p",{className:"text-sm text-gray-500",children:g.activityDate.toLocaleDateString("zh-CN")})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"è¯·é€‰æ‹©è¯„ä»·ç±»å‹"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["GOOD","BAD","GHOST","SKIP"].map((t=>{const s=(e=>({GOOD:{label:"å¥½è¯„",icon:"ğŸ‘",description:"è¿™ä½ä¼™ä¼´è¡¨ç°å¾ˆæ£’",gradient:"from-green-400 to-emerald-500",bgColor:"bg-green-50",textColor:"text-green-700"},BAD:{label:"å·®è¯„",icon:"ğŸ‘",description:"ä½“éªŒä¸å¤ªå¥½",gradient:"from-red-400 to-rose-500",bgColor:"bg-red-50",textColor:"text-red-700"},GHOST:{label:"é¸½å­",icon:"ğŸ•Šï¸",description:"ä¸´æ—¶å–æ¶ˆæˆ–çˆ½çº¦",gradient:"from-gray-400 to-slate-500",bgColor:"bg-gray-50",textColor:"text-gray-700"},SKIP:{label:"è·³è¿‡",icon:"â­ï¸",description:"ä¸äº†è§£ï¼Œä¸è¯„ä»·",gradient:"from-blue-400 to-indigo-500",bgColor:"bg-blue-50",textColor:"text-blue-700"}}[e]))(t),r=b.rating===t;return e.jsx("button",{onClick:()=>(e=>{j((t=>({...t,rating:e}))),p(null)})(t),className:"p-4 rounded-xl border-2 transition-all duration-200 "+(r?`border-transparent bg-gradient-to-r ${s.gradient} text-white shadow-lg`:`border-gray-200 hover:border-gray-300 ${s.bgColor} ${s.textColor}`),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:s.icon}),e.jsx("div",{className:"font-semibold mb-1",children:s.label}),e.jsx("div",{className:"text-xs "+(r?"text-white/80":"text-gray-600"),children:s.description})]})},t)}))})]}),"SKIP"!==b.rating&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["è¡¥å……è¯´æ˜ ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"(å¯é€‰)"})]}),e.jsx(s,{value:b.comment,onChange:e=>{j((t=>({...t,comment:e})))},placeholder:"GOOD"===b.rating?"åˆ†äº«ä¸€ä¸‹è¿™æ¬¡æ„‰å¿«çš„æ”€å²©ä½“éªŒ...":"BAD"===b.rating?"è¯´è¯´é‡åˆ°çš„é—®é¢˜ï¼Œå¸®åŠ©æ”¹è¿›...":"è¯¦ç»†è¯´æ˜æƒ…å†µ...",maxLength:500,rows:4,className:"w-full"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["GOOD"===b.rating&&"å¥½è¯„å¯ä»¥é¼“åŠ±ä¼™ä¼´ç»§ç»­ä¿æŒ","BAD"===b.rating&&"å·®è¯„éœ€è¦æä¾›å…·ä½“åŸå› ","GHOST"===b.rating&&"è¯·ç®€è¦è¯´æ˜å…·ä½“æƒ…å†µ"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[b.comment.length,"/500"]})]})]}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-red-600 mr-3",children:"âš ï¸"}),e.jsx("div",{className:"text-red-700",children:v})]})}),e.jsx("div",{className:"sticky bottom-4",children:e.jsx(r,{onClick:async e=>{if(e?.preventDefault(),d)if(x)try{if(!(await fetch("/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityId:d,reviewType:b.rating,comment:b.comment.trim()||void 0,rating:"GOOD"===b.rating?5:"BAD"===b.rating?1:3})})).ok)throw new Error("Failed to submit review");o.success("Review submitted successfully!"),m("/my-activities")}catch(t){o.error("Failed to submit review. Please try again.")}else o.error("User not authenticated");else o.error("Activity ID is missing")},disabled:u,variant:"primary",className:"w-full h-12 text-lg font-semibold shadow-lg",children:u?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"æäº¤ä¸­..."]}):"æäº¤è¯„ä»·"})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3 mt-0.5",children:"â„¹ï¸"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"è¯„ä»·è¯´æ˜"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"â€¢ è¯„ä»·å°†åœ¨æ´»åŠ¨ç»“æŸå 48 å°æ—¶å†…æœ‰æ•ˆ"}),e.jsx("li",{children:"â€¢ è¯„ä»·ä¸€æ—¦æäº¤æ— æ³•ä¿®æ”¹ï¼Œè¯·æ…é‡é€‰æ‹©"}),e.jsx("li",{children:"â€¢ æ¶æ„è¯„ä»·å°†è¢«ç³»ç»Ÿæ ‡è®°ï¼Œå½±å“ä¿¡èª‰åº¦"}),e.jsx("li",{children:'â€¢ é€‰æ‹©"è·³è¿‡"ä¸ä¼šå½±å“åŒæ–¹ä¿¡èª‰'})]})]})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"åŠ è½½ä¸­..."})]})})};export{d as ReviewForm,d as default};
