import{j as e,U as t,T as s,B as r}from"./auth-features-B9i09fKj.js";import{b as a,u as i,r as l}from"./router-DIp0qzM7.js";import{u as n}from"./activity-features-BeCPKsHJ.js";import{B as o}from"./notifications-DK5Y3Ipx.js";import"./utils-C8L9ZeeV.js";import"./storage-BRXjPTYW.js";import"./react-core-DJd1KkWy.js";import"./state-Dl9MXZu6.js";import"./datetime-C5xEksKA.js";import"./http-client-CnGGTTUv.js";const d=()=>{const{activityId:d,targetId:c}=a(),m=i(),{user:x}=n(),[g,h]=l.useState(null),[b,j]=l.useState({rating:"SKIP",comment:""}),[u]=l.useState(!1),[v,p]=l.useState(null);return l.useEffect((()=>{d&&c&&h({id:c,name:"攀岩伙伴",avatar:"/images/default-avatar.jpg",activityTitle:"周末欢乐抱石局",activityDate:new Date})}),[d,c]),g?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-blue-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>m(-1),className:"flex items-center text-gray-600 hover:text-gray-800 mb-4",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"返回"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"评价活动伙伴"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(t,{avatar:g.avatar,nickname:g.name,size:"lg"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:g.name}),e.jsx("p",{className:"text-gray-600",children:g.activityTitle}),e.jsx("p",{className:"text-sm text-gray-500",children:g.activityDate.toLocaleDateString("zh-CN")})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"请选择评价类型"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["GOOD","BAD","GHOST","SKIP"].map((t=>{const s=(e=>({GOOD:{label:"好评",icon:"👍",description:"这位伙伴表现很棒",gradient:"from-green-400 to-emerald-500",bgColor:"bg-green-50",textColor:"text-green-700"},BAD:{label:"差评",icon:"👎",description:"体验不太好",gradient:"from-red-400 to-rose-500",bgColor:"bg-red-50",textColor:"text-red-700"},GHOST:{label:"鸽子",icon:"🕊️",description:"临时取消或爽约",gradient:"from-gray-400 to-slate-500",bgColor:"bg-gray-50",textColor:"text-gray-700"},SKIP:{label:"跳过",icon:"⏭️",description:"不了解，不评价",gradient:"from-blue-400 to-indigo-500",bgColor:"bg-blue-50",textColor:"text-blue-700"}}[e]))(t),r=b.rating===t;return e.jsx("button",{onClick:()=>(e=>{j((t=>({...t,rating:e}))),p(null)})(t),className:"p-4 rounded-xl border-2 transition-all duration-200 "+(r?`border-transparent bg-gradient-to-r ${s.gradient} text-white shadow-lg`:`border-gray-200 hover:border-gray-300 ${s.bgColor} ${s.textColor}`),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:s.icon}),e.jsx("div",{className:"font-semibold mb-1",children:s.label}),e.jsx("div",{className:"text-xs "+(r?"text-white/80":"text-gray-600"),children:s.description})]})},t)}))})]}),"SKIP"!==b.rating&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["补充说明 ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:"(可选)"})]}),e.jsx(s,{value:b.comment,onChange:e=>{j((t=>({...t,comment:e})))},placeholder:"GOOD"===b.rating?"分享一下这次愉快的攀岩体验...":"BAD"===b.rating?"说说遇到的问题，帮助改进...":"详细说明情况...",maxLength:500,rows:4,className:"w-full"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["GOOD"===b.rating&&"好评可以鼓励伙伴继续保持","BAD"===b.rating&&"差评需要提供具体原因","GHOST"===b.rating&&"请简要说明具体情况"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[b.comment.length,"/500"]})]})]}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-red-600 mr-3",children:"⚠️"}),e.jsx("div",{className:"text-red-700",children:v})]})}),e.jsx("div",{className:"sticky bottom-4",children:e.jsx(r,{onClick:async e=>{if(e?.preventDefault(),d)if(x)try{if(!(await fetch("/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityId:d,reviewType:b.rating,comment:b.comment.trim()||void 0,rating:"GOOD"===b.rating?5:"BAD"===b.rating?1:3})})).ok)throw new Error("Failed to submit review");o.success("Review submitted successfully!"),m("/my-activities")}catch(t){o.error("Failed to submit review. Please try again.")}else o.error("User not authenticated");else o.error("Activity ID is missing")},disabled:u,variant:"primary",className:"w-full h-12 text-lg font-semibold shadow-lg",children:u?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"提交中..."]}):"提交评价"})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3 mt-0.5",children:"ℹ️"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"评价说明"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"• 评价将在活动结束后 48 小时内有效"}),e.jsx("li",{children:"• 评价一旦提交无法修改，请慎重选择"}),e.jsx("li",{children:"• 恶意评价将被系统标记，影响信誉度"}),e.jsx("li",{children:'• 选择"跳过"不会影响双方信誉'})]})]})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"加载中..."})]})})};export{d as ReviewForm,d as default};
